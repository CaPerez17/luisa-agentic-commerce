# Caddyfile para LUISA - HTTPS automático con Let's Encrypt
# Dominio: luisa-agent.online

luisa-agent.online {
    # Reverse proxy al backend
    reverse_proxy backend:8000 {
        # Health check
        health_uri /health
        health_interval 30s
        health_timeout 10s
        
        # Headers
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote}
        header_up X-Forwarded-Proto {scheme}
    }
    
    # Logging
    log {
        output stdout
        format json
    }
    
    # Compresión
    encode gzip
    
    # Seguridad headers
    header {
        # Prevenir clickjacking
        X-Frame-Options "SAMEORIGIN"
        # XSS protection
        X-Content-Type-Options "nosniff"
        # Referrer policy
        Referrer-Policy "strict-origin-when-cross-origin"
    }
}

# Redirección HTTP -> HTTPS (opcional, Caddy lo hace automáticamente)
# Pero lo dejamos explícito para claridad
:80 {
    redir https://luisa-agent.online{uri} permanent
}

